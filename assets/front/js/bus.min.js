!function n(t,e,o){function i(u,f){if(!e[u]){if(!t[u]){var c="function"==typeof require&&require;if(!f&&c)return c(u,!0);if(r)return r(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var a=e[u]={exports:{}};t[u][0].call(a.exports,function(n){var e=t[u][1][n];return i(e?e:n)},a,a.exports,n,t,e,o)}return e[u].exports}for(var r="function"==typeof require&&require,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(n,t){function e(){}var o=t.exports={};o.nextTick=function(){var n="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(n)return function(n){return window.setImmediate(n)};if(t){var e=[];return window.addEventListener("message",function(n){var t=n.source;if((t===window||null===t)&&"process-tick"===n.data&&(n.stopPropagation(),e.length>0)){var o=e.shift();o()}},!0),function(n){e.push(n),window.postMessage("process-tick","*")}}return function(n){setTimeout(n,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=e,o.addListener=e,o.once=e,o.off=e,o.removeListener=e,o.removeAllListeners=e,o.emit=e,o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(n,t){"use strict";function e(n){function t(n){return null===c?void a.push(n):void r(function(){var t=c?n.onFulfilled:n.onRejected;if(null===t)return void(c?n.resolve:n.reject)(s);var e;try{e=t(s)}catch(o){return void n.reject(o)}n.resolve(e)})}function e(n){try{if(n===l)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void i(t.bind(n),e,u)}c=!0,s=n,f()}catch(o){u(o)}}function u(n){c=!1,s=n,f()}function f(){for(var n=0,e=a.length;e>n;n++)t(a[n]);a=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");var c=null,s=null,a=[],l=this;this.then=function(n,e){return new l.constructor(function(i,r){t(new o(n,e,i,r))})},i(n,e,u)}function o(n,t,e,o){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof t?t:null,this.resolve=e,this.reject=o}function i(n,t,e){var o=!1;try{n(function(n){o||(o=!0,t(n))},function(n){o||(o=!0,e(n))})}catch(i){if(o)return;o=!0,e(i)}}var r=n("asap");t.exports=e},{asap:4}],3:[function(n,t){"use strict";function e(n){this.then=function(t){return"function"!=typeof t?this:new o(function(e,o){i(function(){try{e(t(n))}catch(i){o(i)}})})}}var o=n("./core.js"),i=n("asap");t.exports=o,e.prototype=o.prototype;var r=new e(!0),u=new e(!1),f=new e(null),c=new e(void 0),s=new e(0),a=new e("");o.resolve=function(n){if(n instanceof o)return n;if(null===n)return f;if(void 0===n)return c;if(n===!0)return r;if(n===!1)return u;if(0===n)return s;if(""===n)return a;if("object"==typeof n||"function"==typeof n)try{var t=n.then;if("function"==typeof t)return new o(t.bind(n))}catch(i){return new o(function(n,t){t(i)})}return new e(n)},o.all=function(n){var t=Array.prototype.slice.call(n);return new o(function(n,e){function o(r,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var f=u.then;if("function"==typeof f)return void f.call(u,function(n){o(r,n)},e)}t[r]=u,0===--i&&n(t)}catch(c){e(c)}}if(0===t.length)return n([]);for(var i=t.length,r=0;r<t.length;r++)o(r,t[r])})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(n){return new o(function(t,e){n.forEach(function(n){o.resolve(n).then(t,e)})})},o.prototype["catch"]=function(n){return this.then(null,n)}},{"./core.js":2,asap:4}],4:[function(n,t){(function(n){function e(){for(;i.next;){i=i.next;var n=i.task;i.task=void 0;var t=i.domain;t&&(i.domain=void 0,t.enter());try{n()}catch(o){if(c)throw t&&t.exit(),setTimeout(e,0),t&&t.enter(),o;setTimeout(function(){throw o},0)}t&&t.exit()}u=!1}function o(t){r=r.next={task:t,domain:c&&n.domain,next:null},u||(u=!0,f())}var i={task:void 0,next:null},r=i,u=!1,f=void 0,c=!1;if("undefined"!=typeof n&&n.nextTick)c=!0,f=function(){n.nextTick(e)};else if("function"==typeof setImmediate)f="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=e,f=function(){s.port2.postMessage(0)}}else f=function(){setTimeout(e,0)};t.exports=o}).call(this,n("_process"))},{_process:1}],5:[function(){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(n){setTimeout(function(){throw n},0)})})},{}],6:[function(n){n("asap");"undefined"==typeof Promise&&(Promise=n("./lib/core.js"),n("./lib/es6-extensions.js")),n("./polyfill-done.js")},{"./lib/core.js":2,"./lib/es6-extensions.js":3,"./polyfill-done.js":5,asap:4}]},{},[6]);
;
"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(){var t=arguments.length?this.then.apply(this,arguments):this;t.then(null,function(t){setTimeout(function(){throw t},0)})});
;
!function(a,b){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a)}(this,function(a){"object"!=typeof exports||a===exports||XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(a){for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=255&a.charCodeAt(d);this.send(c)}),a.BUS=function(b,c,d,e){var f,g="1.0",h=function(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])},i=function(b,c){var d=!1;b.headers["Content-Type"]?"application/json"!=b.headers["Content-Type"]&&(d=!0):b.headers["Content-Type"]="application/json";var e=(new Date).getTime();b.url.indexOf("?")!=-1?b.url+="&t="+e:b.url+="?t="+e;var g=function(a){var b=JSON.parse(a);c(null,b)},i={200:g,0:g};if(h(b.status_handlers,function(a,b){i[a]=b}),"object"==typeof exports&&a===exports){var j=require("http");f="www.kuaizhan.com";var k={hostname:f,port:80,path:"/bus"+b.url,method:b.method,headers:b.headers},l=j.request(k,function(a){var b="";a.on("data",function(a){b+=a}),a.on("end",function(){i[a.statusCode]?i[a.statusCode](b):c(new Error("msg:"+b))})});l.on("error",function(a){throw a}),l.write(b.data),l.end()}else{f="$HOST";var m=new XMLHttpRequest;m.withCredentials=!0,m.open(b.method,b.url),h(b.headers,function(a,b){m.setRequestHeader(a,b)}),m.timeout=2e3,m.onreadystatechange=function(){4==m.readyState&&(i[m.status]?i[m.status].call(this,m.responseText):c(new Error("status is"+m.status+" msg:"+m.responseText)))},d?m.sendAsBinary(b.data):m.send(b.data)}},j=function(a,f){i({url:"/"+g+"/"+a.url,method:a.method,headers:{"kz-cookie":"object"!=typeof process?document.cookie:null,"Content-Type":"application/json","app-id":b,"app-key":c,"X-Master-Key":d,"app-env":e},data:a.data?JSON.stringify(a.data):""},f)},k=function(a,h,j,k){var l='Content-Disposition: form-data; name="file"; filename="'+a+'"\r\nContent-Type: '+h+"\r\n\r\n",m="---------------------------"+Date.now().toString(16);i({headers:{"Content-Type":"multipart/form-data; boundary="+m,"app-id":b,"app-key":c,"X-Master-Key":d,"app-env":e},method:"POST",data:"--"+m+"\r\n"+l+j+"\r\n--"+m+"--\r\n",url:f+"/"+g+"/files"},k)};return{File:function(a){return{save:function(){return new Promise(function(b,c){var d=new FileReader;d.onload=function(d){k(a.name,a.type,d.target.result,function(a,d){a?c(a):b(d.url)})},d.readAsBinaryString(a)})}}},Buffer:function(a){return{save:function(){return new Promise(function(b,c){k("file","buffer",a,function(a,d){a?c(a):b(d.url)})})}}},Func:function(a){var c=function(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")},d=ops&&ops.dev?"dev":"pro",e="apps/"+b+"/env/"+d+"/funcs/"+a;return{get:function(a){return new Promise(function(b,d){var f=c(a);j({url:e+"?"+f,method:"GET"},function(a,c){a?d(a):b(c)})})},post:function(a,b){return new Promise(function(d,f){var g=c(a);j({url:e+"?"+g,method:"POST",data:b},function(a,b){a?f(a):d(b)})})},put:function(a,b){return new Promise(function(d,f){try{var g=c(a);j({url:e+"?"+g,method:"PUT",data:b},function(a,b){a?f(a):d(b)})}catch(h){f(h.message)}})},"delete":function(a){return new Promise(function(b,d){var f=c(a);j({url:e+"?"+f,method:"DELETE"},function(a,c){a?d(a):b(c)})})}}},Collection:function(a){var b=this;return{create_query:function(){var c={query:{},options:{}},d=function(a,b,d){var e=null;d instanceof Date&&(e="_date"),b?(c.query[a]={},c.query[a][b]=d):c.query[a]=d};return{find_by_id:function(c){return new Promise(function(d,e){j({url:"collections/"+a+"/documents/"+c,method:"GET"},function(c,f){c?e(c):f?d(b.Collection(a).create_obj(f)):d()})})},destroy_by_id:function(b){return new Promise(function(c,d){j({url:"collections/"+a+"/documents/"+b,method:"DELETE"},function(a){a?d(a):c()})})},exec:function(d){return new Promise(function(d,e){j({url:"collections/"+a+"/documents?query="+JSON.stringify(c),method:"GET"},function(c,f){c?e(c):d(f.map(function(c){var d=b.Collection(a).create_obj();return d.set_all(c),d}))})})},count:function(b){return c.count=1,new Promise(function(b,d){j({url:"collections/"+a+"/documents?query="+JSON.stringify(c),method:"GET"},function(a,c){a?d(a):b(c)})})},destroy:function(b){return new Promise(function(b,d){j({url:"collections/"+a+"/documents?query="+JSON.stringify(c),method:"DELETE"},function(a){a?d(a):b()})})},update:function(b,d){return new Promise(function(d,e){j({url:"collections/"+a+"/documents?query="+JSON.stringify(c),method:"PUT",data:b},function(a){a?e(a):d()})})},equal:function(a,b){return d(a,null,b),this},not_equal:function(a,b){return d(a,"$ne",b),this},great_than:function(a,b){return d(a,"$gt",b),this},great_than_equal_to:function(a,b){return d(a,"$gte",b),this},less_than:function(a,b){return d(a,"$lt",b),this},less_than_equal_to:function(a,b){return d(a,"$lte",b),this},"in":function(a,b){return d(a,"$in",b),this},not_in:function(a,b){return d(a,"$nin",b),this},exist:function(a){return d(a,"$exists",!0),this},not_exist:function(a){return d(a,"$exists",!1),this},or:function(a){if(!c.query.$or){var b=c.query;c.query={},c.query.$or=[b]}var d=a.get_obj();return d.query.$or?c.query.$or=c.query.$or.concat(d.query.$or):c.query.$or.push(d.query),this},limit:function(a){return c.options.limit=a,this},skip:function(a){return c.options.skip=a,this},asc:function(){return c.options.sort||(c.options.sort={}),Array.prototype.slice.call(arguments).forEach(function(a){c.options.sort[a]=1}),this},desc:function(){return c.options.sort||(c.options.sort={}),Array.prototype.slice.call(arguments).forEach(function(a){c.options.sort[a]=-1}),this},select:function(){var a={};return Array.prototype.slice.call(arguments).forEach(function(b){a[b]=1}),c.options.select={fields:a},this},get_obj:function(){return c}}},create_obj:function(b){var c=b?b:{},d={$set:{},$inc:{}};if(b&&b._id)for(var e in b)b.hasOwnProperty(e)&&"_id"!=e&&(d.$set[e]=b[e]);var f=function(a){for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0};return{get:function(a){return c[a]},set:function(a,b){return c&&c._id&&(d.$set[a]=b),c[a]=b,this},set_all:function(a){return c=a,this},get_all:function(){return c},increment:function(a,b){return delete d.$set[a],d.$inc[a]=b,this},toJSON:function(){return c},save:function(b){return new Promise(function(b,e){c?c._id||f(c)?f(d.$set)&&f(d.$inc)?e(new Error("content must not be null!")):j({url:"collections/"+a+"/documents/"+c._id,method:"PUT",data:d},function(a,f){a?e(a):(c=f,d.$set={},d.$inc={},b())}):(delete c._id,j({url:"collections/"+a+"/documents",method:"POST",data:c},function(a,d){a?e(a):(c=d[0],b())})):e(new Error("document could not be null when create or update"))})},destroy:function(b){return new Promise(function(b,d){c&&c._id?j({url:"collections/"+a+"/documents/"+c._id,method:"DELETE"},function(a){a?d(a):b()}):b()})}}}}}}}});